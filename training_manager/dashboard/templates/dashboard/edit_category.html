{% extends "dashboard/base.html" %}
{% load i18n %}
{% block title %}{% trans "Редагувати категорію — Athletic Manager" %}{% endblock %}

{% block content %}
<style>
  :root{
    --control-bg:#ffffff; --control-text:#0f172a; --control-border:rgba(15,23,42,.12);
    --control-disabled-bg:#f1f5f9; --control-disabled-text:#64748b;
    --select-arrow:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%235b6b92'%3E%3Cpath fill-rule='evenodd' d='M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.29a.75.75 0 01-.02-1.08z' clip-rule='evenodd'/%3E%3C/svg%3E");
  }
  .dark{
    --control-bg:rgba(255,255,255,.06); --control-text:#e5e7eb; --control-border:rgba(255,255,255,.18);
    --control-disabled-bg:rgba(255,255,255,.08); --control-disabled-text:#cbd5e1;
    --select-arrow:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%23cbd5e1'%3E%3Cpath fill-rule='evenodd' d='M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.29a.75.75 0 01-.02-1.08z' clip-rule='evenodd'/%3E%3C/svg%3E");
    color-scheme:dark;
  }

  .form-skin input[type="text"],
  .form-skin input[type="number"],
  .form-skin input[type="time"],
  .form-skin input[type="date"],
  .form-skin input[type="file"],
  .form-skin select,
  .form-skin textarea{
    background:var(--control-bg); color:var(--control-text);
    border:1px solid var(--control-border); border-radius:.625rem; padding:.5rem .625rem;
  }
  .form-skin input[disabled], .form-skin select[disabled], .form-skin textarea[disabled],
  .form-skin input[readonly], .form-skin select[readonly], .form-skin textarea[readonly]{
    background:var(--control-disabled-bg); color:var(--control-disabled-text); border-color:var(--control-border); opacity:1; cursor:not-allowed;
  }
  .form-skin select{appearance:none; padding-right:2.25rem; background-image:var(--select-arrow); background-repeat:no-repeat; background-position:right .6rem center; background-size:16px 16px;}
  .dark .form-skin select option, .dark .form-skin select optgroup{background:#0f172a; color:#e5e7eb;}
  .dark .form-skin select option:checked{background:#1e49ff; color:#fff;}
</style>

<h1 class="hidden" aria-hidden="true">{% trans "Редагувати категорію" %}</h1>

<div class="mx-auto w-full max-w-[880px]">
  <article class="card form-skin">
    <header class="px-6 pt-6 pb-3 border-b border-gray-200 dark:border-white/10">
      <h2 class="text-xl md:text-2xl font-semibold flex items-center gap-2">
        ✏️ {% trans "Редагувати категорію" %}
      </h2>
    </header>

    <form method="post" novalidate>
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="px-6 pt-4">
          <div class="rounded-lg bg-red-50 text-red-700 px-3 py-2 text-sm dark:bg-red-900/20 dark:text-red-300">
            {% for err in form.non_field_errors %}<div>{{ err }}</div>{% endfor %}
          </div>
        </div>
      {% endif %}

      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

          <div>
            <label for="{{ form.attempt_type.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">
              {% trans "Тип спроби" %} <span class="text-red-600">*</span>
            </label>
            {{ form.attempt_type }}
            {% if form.attempt_type.errors %}
              <ul class="mt-1 text-xs text-red-600 dark:text-red-400 space-y-0.5">
                {% for err in form.attempt_type.errors %}<li>{{ err }}</li>{% endfor %}
              </ul>
            {% endif %}
          </div>

          <div>
            <label for="{{ form.place.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">
              {% trans "Місце проведення" %} <span class="text-red-600">*</span>
            </label>
            {{ form.place }}
            {% if form.place.errors %}
              <ul class="mt-1 text-xs text-red-600 dark:text-red-400 space-y-0.5">
                {% for err in form.place.errors %}<li>{{ err }}</li>{% endfor %}
              </ul>
            {% endif %}
          </div>

          <div>
            <label for="{{ form.date.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">
              {% trans "Дата" %} <span class="text-red-600">*</span>
            </label>
            {{ form.date }}
            {% if form.date.errors %}
              <ul class="mt-1 text-xs text-red-600 dark:text-red-400 space-y-0.5">
                {% for err in form.date.errors %}<li>{{ err }}</li>{% endfor %}
              </ul>
            {% endif %}
          </div>

          <div id="rank-wrapper">
            <label for="{{ form.rank.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">
              {% trans "Зайняте місце" %} <span id="rank-required" class="text-red-600">*</span>
            </label>
            {{ form.rank }}
            {% if form.rank.errors %}
              <ul class="mt-1 text-xs text-red-600 dark:text-red-400 space-y-0.5">
                {% for err in form.rank.errors %}<li>{{ err }}</li>{% endfor %}
              </ul>
            {% endif %}
          </div>

        </div>
      </div>

      <footer class="px-6 pb-6 pt-3 border-t border-gray-200 dark:border-white/10 flex items-center justify-end gap-3">
        <a href="{% url 'upload' %}" class="btn btn-ghost btn-sm">{% trans "Відмінити" %}</a>
        <button type="submit" class="btn btn-primary btn-sm">{% trans "Зберегти зміни" %}</button>
      </footer>
    </form>
  </article>
</div>

<script>
  // Показувати «Зайняте місце» тільки для змагань
  (function () {
    const typeSel  = document.getElementById('id_attempt_type');
    const rankWrap = document.getElementById('rank-wrapper');
    const rankReq  = document.getElementById('rank-required');
    const rankInp  = document.getElementById('id_rank');

    function toggleRank() {
      const isComp = typeSel && typeSel.value === 'competition';
      if (!rankWrap) return;
      rankWrap.style.display = isComp ? '' : 'none';
      if (rankReq) rankReq.style.display = isComp ? '' : 'none';
      if (rankInp) isComp ? rankInp.setAttribute('required','required') : rankInp.removeAttribute('required');
    }
    typeSel?.addEventListener('change', toggleRank);
    toggleRank();
  })();
</script>
{% endblock %}
