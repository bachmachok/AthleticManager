{% extends "dashboard/base.html" %}
{% block title %}Редагувати категорію — Athletic Manager{% endblock %}

{% block content %}
  {# семантичний H1, але невидимий — щоб не дублювався з заголовком картки #}
  <h1 class="hidden" aria-hidden="true">Редагувати категорію</h1>

  <div class="mx-auto w-full max-w-[880px]">
    <article class="card">
      <header class="px-6 pt-6 pb-3 border-b border-gray-200 dark:border-white/10">
        <h2 class="text-xl md:text-2xl font-semibold flex items-center gap-2">
          ✏️ Редагувати категорію
        </h2>
      </header>

      <form method="post" novalidate>
        {% csrf_token %}

        {% if form.non_field_errors %}
          <div class="px-6 pt-4">
            <div class="rounded-lg bg-red-50 text-red-700 px-3 py-2 text-sm dark:bg-red-900/20 dark:text-red-300">
              {% for err in form.non_field_errors %}<div>{{ err }}</div>{% endfor %}
            </div>
          </div>
        {% endif %}

        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <div>
              <label for="{{ form.attempt_type.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">
                {{ form.attempt_type.label }} <span class="text-red-600">*</span>
              </label>
              {{ form.attempt_type }}
              {% if form.attempt_type.errors %}
                <ul class="mt-1 text-xs text-red-600 dark:text-red-400 space-y-0.5">
                  {% for err in form.attempt_type.errors %}<li>{{ err }}</li>{% endfor %}
                </ul>
              {% endif %}
            </div>

            <div>
              <label for="{{ form.place.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">
                {{ form.place.label }} <span class="text-red-600">*</span>
              </label>
              {{ form.place }}
              {% if form.place.errors %}
                <ul class="mt-1 text-xs text-red-600 dark:text-red-400 space-y-0.5">
                  {% for err in form.place.errors %}<li>{{ err }}</li>{% endfor %}
                </ul>
              {% endif %}
            </div>

            <div>
              <label for="{{ form.date.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">
                {{ form.date.label }} <span class="text-red-600">*</span>
              </label>
              {{ form.date }}
              {% if form.date.errors %}
                <ul class="mt-1 text-xs text-red-600 dark:text-red-400 space-y-0.5">
                  {% for err in form.date.errors %}<li>{{ err }}</li>{% endfor %}
                </ul>
              {% endif %}
            </div>

            <div id="rank-wrapper">
              <label for="{{ form.rank.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">
                {{ form.rank.label }} <span id="rank-required" class="text-red-600">*</span>
              </label>
              {{ form.rank }}
              {% if form.rank.errors %}
                <ul class="mt-1 text-xs text-red-600 dark:text-red-400 space-y-0.5">
                  {% for err in form.rank.errors %}<li>{{ err }}</li>{% endfor %}
                </ul>
              {% endif %}
            </div>

          </div>
        </div>

        <footer class="px-6 pb-6 pt-3 border-t border-gray-200 dark:border-white/10 flex items-center justify-end gap-3">
          <a href="{% url 'upload' %}" class="btn btn-ghost btn-sm">Відмінити</a>
          <button type="submit" class="btn btn-primary btn-sm">Зберегти зміни</button>
        </footer>
      </form>
    </article>
  </div>

  <script>
    // показувати "Зайняте місце" лише для змагальної категорії
    (function () {
      const typeSel  = document.getElementById('id_attempt_type');
      const rankWrap = document.getElementById('rank-wrapper');
      const rankReq  = document.getElementById('rank-required');
      const rankInp  = document.getElementById('id_rank');

      function toggleRank() {
        const isComp = typeSel && typeSel.value === 'competition';
        if (!rankWrap) return;
        rankWrap.style.display = isComp ? '' : 'none';
        if (rankReq) rankReq.style.display = isComp ? '' : 'none';
        if (rankInp) isComp ? rankInp.setAttribute('required', 'required')
                            : rankInp.removeAttribute('required');
      }

      typeSel?.addEventListener('change', toggleRank);
      toggleRank();
    })();
  </script>
{% endblock %}
