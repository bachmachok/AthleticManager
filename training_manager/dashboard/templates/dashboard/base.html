{% load static %}
<!DOCTYPE html>
<html lang="uk" class="h-full {% if request.session.theme == 'dark' %}dark{% endif %}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Athletic Manager{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'dashboard/app.css' %}">
  {% block extra_head %}{% endblock %}
</head>
<body id="app" class="h-full bg-gray-50 text-gray-900 antialiased dark:bg-gray-900 dark:text-gray-100">

<!-- Overlay –¥–ª—è –º–æ–±—ñ–ª—å–Ω–æ–≥–æ off‚Äëcanvas -->
<div id="overlay" class="fixed inset-0 z-40 hidden bg-black/40 backdrop-blur-sm md:hidden"></div>

<!-- –ù–∞ md+ —Ü–µ –≥—Ä—ñ–¥ [sidebar | content] -->
<div id="layout" class="min-h-screen md:layout-grid">

  <!-- SIDEBAR -->
  <aside id="sidebar"
         class="sidebar z-50 bg-gradient-to-b from-brand-800 to-brand-900 text-white
                md:static md:translate-x-0 md:h-auto md:flex md:flex-col
                fixed inset-y-0 left-0 -translate-x-full transition-all duration-300">

    <!-- –í–µ—Ä—Ö–Ω—ñ–π –±–∞—Ä -->
    <div class="sb-top">
      <div class="flex items-center gap-3">
        <!-- –õ–æ–≥–æ (—É –∑–≥–æ—Ä–Ω—É—Ç–æ–º—É —Ä–µ–∂–∏–º—ñ –Ω–∞ hover –ø–æ–∫–∞–∑—É—î "–±—É—Ä–≥–µ—Ä"; –∫–ª—ñ–∫ ‚Äî –ø–µ—Ä–µ–º–∏–∫–∞—î) -->
        <button id="logoToggle" class="logo-toggle" aria-label="–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏/–∑–≥–æ—Ä–Ω—É—Ç–∏">
          <span class="ico-logo">üèÉ</span>
          <span class="ico-menu">‚ò∞</span>
        </button>
        <span class="brand-text text-white/90 font-semibold select-none">Athletic Manager</span>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞-–∫–æ–ª–∞–ø—Å –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –ª–∏—à–µ –≤ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ–º—É —Å—Ç–∞–Ω—ñ (—É –∑–≥–æ—Ä–Ω—É—Ç–æ–º—É –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞ CSS) -->
      <button id="menuToggle" class="safe-tap rounded-lg bg-white/10 px-3 py-2 hover:bg-white/20 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/40"
              aria-label="–ó–≥–æ—Ä–Ω—É—Ç–∏ –º–µ–Ω—é" aria-expanded="true">‚ò∞</button>
    </div>

    <!-- –ë–ª–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ‚Äî –ø—Ä–∏ –∑–≥–æ—Ä–Ω–µ–Ω–Ω—ñ –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–Ω–∏–∫–∞—î -->
    <div class="user-block m-4 rounded-lg bg-white/5 p-3">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 shrink-0 rounded-full bg-white/20 grid place-items-center">üë§</div>
        <div class="min-w-0">
          {% if user.is_authenticated %}
            <div class="font-medium truncate">{{ user.username }}</div>
            <div class="text-white/70 text-sm">–í—ñ—Ç–∞—é!</div>
          {% else %}
            <div class="font-medium">–ì—ñ—Å—Ç—å</div>
            <div class="text-white/70 text-sm">–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å</div>
          {% endif %}
        </div>
      </div>
      <div class="mt-3">
        {% if user.is_authenticated %}
          <a href="{% url 'logout' %}" class="btn-ghost w-full justify-center bg-white/10 hover:bg-white/20">–í–∏—Ö—ñ–¥</a>
        {% else %}
          <a href="{% url 'login' %}" class="btn-primary w-full justify-center">–í—Ö—ñ–¥</a>
        {% endif %}
      </div>
    </div>

    <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è -->
    {% with current=request.resolver_match.url_name %}
    <nav class="flex flex-col gap-1 px-2 py-2 text-sm">
      <a href="{% url 'index' %}" class="nav-link {% if current == 'index' %}nav-link-active{% endif %}">
        <span class="nav-icon">üè†</span>
        <span class="nav-text">–ì–æ–ª–æ–≤–Ω–∞</span>
        <span class="nav-under hidden">–ì–æ–ª–æ–≤–Ω–∞</span>
      </a>
      <a href="{% url 'library' %}" class="nav-link {% if current == 'library' %}nav-link-active{% endif %}">
        <span class="nav-icon">üìö</span>
        <span class="nav-text">–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞</span>
        <span class="nav-under hidden">–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞</span>
      </a>
      <a href="{% url 'upload' %}" class="nav-link {% if current == 'upload' %}nav-link-active{% endif %}">
        <span class="nav-icon">‚§¥Ô∏è</span>
        <span class="nav-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</span>
        <span class="nav-under hidden">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</span>
      </a>
      <a href="{% url 'settings' %}" class="nav-link {% if current == 'settings' %}nav-link-active{% endif %}">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span class="nav-text">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</span>
        <span class="nav-under hidden">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</span>
      </a>
    </nav>
    {% endwith %}

    <!-- –ù–ò–ñ–ù–Ü–ô –ë–õ–û–ö –í–ò–î–ê–õ–ï–ù–û: –Ω—ñ—è–∫–∏—Ö –≤–µ—Ä—Å—ñ–π —ñ –ø–µ—Ä–µ–º–∏–∫–∞—á–∞ —Ç–µ–º–∏ -->
  </aside>

  <!-- CONTENT -->
  <main id="main" class="pt-4 md:pt-6">
    <div class="hidden md:flex justify-end pr-4 text-xs text-gray-500 dark:text-gray-400">
      {% if request.resolver_match.url_name %}/ {{ request.resolver_match.url_name }}{% endif %}
    </div>

    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
      {% block content %}{% endblock %}
    </div>
  </main>
</div>

<script>
  const app = document.getElementById('app');
  const layout = document.getElementById('layout');
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  const menuToggle = document.getElementById('menuToggle'); // –≤–∏–¥–∏–º–∏–π –ª–∏—à–µ —É —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ–º—É
  const logoToggle = document.getElementById('logoToggle'); // –∑–∞–≤–∂–¥–∏ —î (—É –∫–æ–ª–∞–ø—Å—ñ –ø—Ä–∞—Ü—é—î —è–∫ –±—É—Ä–≥–µ—Ä)
  const mqDesktop = window.matchMedia('(min-width: 768px)');

  function openMobile() {
    sidebar.classList.remove('-translate-x-full');
    overlay.classList.remove('hidden');
    document.documentElement.style.overflow = 'hidden';
  }
  function closeMobile() {
    sidebar.classList.add('-translate-x-full');
    overlay.classList.add('hidden');
    document.documentElement.style.overflow = '';
  }
  function toggleDesktopCollapse() {
    app.classList.toggle('has-collapsed');
    layout.classList.toggle('layout-grid-collapsed');
    sidebar.classList.toggle('sidebar--collapsed');
    menuToggle?.setAttribute('aria-expanded', String(!app.classList.contains('has-collapsed')));
  }

  function toggleMenu() {
    if (mqDesktop.matches) {
      toggleDesktopCollapse();
    } else {
      const hidden = sidebar.classList.contains('-translate-x-full');
      hidden ? openMobile() : closeMobile();
    }
  }

  menuToggle?.addEventListener('click', toggleMenu);
  logoToggle?.addEventListener('click', toggleMenu); // —É –∑–≥–æ—Ä–Ω—É—Ç–æ–º—É –∫–ª—ñ–∫ –ø–æ –ª–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞—î
  overlay?.addEventListener('click', closeMobile);
  window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeMobile(); });
</script>

{% block extra_scripts %}{% endblock %}
</body>
</html>
